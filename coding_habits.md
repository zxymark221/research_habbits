# Coding

Coding is a highly useful skill throughout your research and future professional career. 
Having a good coding habit can help you improve your research efficiency, avoid unnecessary error and bugs, and make it easier to understand by your collaborators. 

Below are some aspects that can make you good at coding.

## Readability

Good code readability is important and has the following merits:
- Easy to understand (by others and even future yourself!)
- Easy to debug. Bugs in code are inevitable. When things do not work, you need to debug that, and clean and tidy code makes it easy to debug.
- Easy to open-source. To have an impactful work, open-sourcing your code to allow the research community to reproduce your results is important. Writing code as clean as possible allows you publish your code as soon as your paper gets published (no need to spend more effort to clean the code).

In this section, I only list some examples to show you why code readability is important. For more details, follow the Python style guides: [PEP 8](https://peps.python.org/pep-0008/) and [Google guideline](https://google.github.io/styleguide/pyguide.html).

- Pay attention to how you name variables, functions and files. Use `intertia = 100` instead of `a = 100`, unless you are quickly testing something and the script will be deleted shortly.

- Write and maintain docstring is helpful. (Question: what is a docstring?)

- If you see repeated code blocks, refactor it by using for loops or make it a generalized function to be called at different places.

- Do not put everything in a single line, split it. (Question: what is the maximum line length suggested by the guideline? How to set it in VSCode?)

See an example [here](https://github.com/openai/spinningup/blob/master/spinup/algos/pytorch/ppo/ppo.py), you can see the code is clean and tidy. The process of making the code nice and clean is called _code refactoring_. See these two videos on how people refactor their code: [Video 1](https://www.bilibili.com/video/BV1xT4y1B7yk) and [Video 2](https://www.bilibili.com/video/BV1QB4y1y7Tr/).

Again, refer to the guidelines mentioned above and make sure you follow them in practice, until these become your muscle memory.

## Tools

Know your tools well!

- __Git__
  
  Always backup your code to the extend that you can afford to the loss of your unsaved work.:

  Git is a `version control` tool for managing your code repository.

  - What to include? 

    This is simple: things that are important, like the code you recently developed for your research, should be included.

  - What not to include? 
    
    This is important: when you are not sure if a file should be included, think twice. Do not include things that are not necessary to the repository. Things that we don't want to include are, for example, your own research notes or some files auto-generated by your computer (*.pyc, .DS_Store). To exclude these files, specify these file types in `.gitignore` to let git directly ignore these files.

  - Basic commands

    Learn basic commands [here](https://docs.github.com/en/get-started/using-git/about-git#basic-git-commands), 90\% of the time you only need these. So, make sure you are familiar with it. Here is a [cheatsheet](https://training.github.com/downloads/zh_CN/github-git-cheat-sheet/) for it, and [another more visually interactive one](https://ndpsoftware.com/git-cheatsheet.html).

  - Pull request
    
    We will get to this later if we need this. For now, you can check what _pull request_ mean and learn it at your free time if interested.

- __Conda environment__

  __ALWAYS__ use conda environments, never use a single Python interpreter for all your projects. 
  
  - Installation: Compared with GUI installation, I personally prefer this command line installation [Link for Mac](https://docs.anaconda.com/free/anaconda/install/mac-os/#command-line-install).

  - Common commands cheatsheet:
  
    - Create a new env: `conda create -n xxx python=3.11`
    - See all existing envs: `conda info --envs`
    - Activate an env: `conda activate xxx`
    - Install packages within the env: `conda install numpy` or `pip install numpy`. See the differences between conda install and pip install [here](https://stackoverflow.com/questions/20994716/what-is-the-difference-between-pip-and-conda). I personally suggest using pip to install.
    - Install your own package: go to the folder where the code for this package is (where `setup.py` is) and then use `pip install -e .`
    - See all existing packages in the env: `conda list`
    - Exist the environment: `conda deactivate`
    - Remove an environment: `conda remove -n xxx --all`

    What are the differences between `conda install numpy` and `pip install numpy`? See [Link](https://www.anaconda.com/blog/understanding-conda-and-pip) and 

  - Share your Conda environment

    If all your packages are installed using `pip`, you can use `pip freeze > requirements.txt` to export all libraries you installed in this environment. This txt file can be shared with your collaborator, and with that your collaborator can install all these libraries using `pip install -r requirements.txt`.

- __VSCode__

  You can choose another integrated development environment, but be sure 
  
  Configurations:
  - How to set up a Python interpreter? Connect with a Conda environment.
  - The settings I used is defined below. To locate this file, search `Open User Settings` in the command palette. I like this setting because:
    * It sets auto-save your code
    * It sets the ruler for Python. (This answers the previous question on what is the maximum line length suggested by the Python guideline. Anyone knows why this weird number?)
    * It specifies the formatter and makes the formatter work when you save your Python file (not the auto-save, but when you press command/control+s). 
    ```
    {
      "files.autoSave": "afterDelay",
      "[python]": {
          "editor.defaultFormatter": "ms-python.autopep8",
          "editor.rulers": [79],
          "editor.formatOnSave": true
      }
    }
    ```
  - See more in the documentation of `settings` [here](https://code.visualstudio.com/docs/getstarted/settings).

  How to use it properly?
  - Single step debugging. Rerun your code without changing anything and just _hoping_ the error goes away by itself does not work at all. Do single step debugging to locate the error and investigate what's happening under the hood.
  - Just my code? Maybe not. When you are debugging your code, sometimes you'd like to see what happens inside a function that is defined by a package you installed. The default VSCode setting does not allow you look inside as the default value for `justMyCode` is true. You can set this to false in `launch.json` in the debugger.
     ```
     {
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python Debugger: Current File",
            "type": "debugpy",
            "request": "launch",
            "justMyCode": false,
            "program": "${file}",
            "console": "integratedTerminal"
        }
    ]
    }
     ```

- __Pylint__

  You don't have to use Pylint if you find other linter more suitable to you.

- __Formatter__

  First, what's the differences between a linter and a formatter? [Answer](https://nono.ma/linter-vs-formatter).

  Use a formatter in VSCode [Link](https://code.visualstudio.com/docs/python/formatting).


- __Jupyter Notebook__

  The Jupyter notebook can be installed using `pip install notebook` and can be started using `jupyter notebook`. 

  Consider when to use Jupyter notebook and when to run Python script. This is a personal choice, but my general principles are:

  - Use `.py` script when formally running a job, when you only care about the final result. E.g., training an ML model.

  - Use notebook when you need interactive feedback or do not have a clear idea what your final results are. E.g., play with the data, try a new code implementation quickly, visualizing results, etc..

- __StackOverflow__

  Take good advantage of StackOverflow, meaning _more than just copy and paste_.

  - Don't ask your labmate immediately, search the error message first. Try to understand more, rather than just get a quick solution.
  - If you cannot find an answer all over the Internet, try ask the question, but remember to provide a good MWE-_Minimum Working Example_. (Help others to understand, help yourself to get the exact answer.)
  

In summary, once you have all the tools integrated to you computer and build up all those good coding habits, you should be able to develop code for your research efficiently!


